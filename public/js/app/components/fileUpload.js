"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var http_1 = require("@angular/http");
var fileUpload_service_1 = require("./fileUpload.service");
var form_service_1 = require("./form.service");
var FileUploadComponent = (function () {
    function FileUploadComponent(_fileUploadService, _http, _formService) {
        this._fileUploadService = _fileUploadService;
        this._http = _http;
        this._formService = _formService;
        this.isUploaded = false;
        this.uploadedFileUrls = [];
        this.display = false;
        this.sent = new core_1.EventEmitter();
    }
    FileUploadComponent.prototype.upload = function () {
    };
    FileUploadComponent.prototype.ngOnInit = function () {
        console.log(this.objStep);
        console.log(this.objStep.configuration.path_model);
    };
    FileUploadComponent.prototype.fileChange = function (event) {
        console.log(event.target);
        var fileList = event.target.files;
        if (fileList.length > 0) {
            var file = fileList[0];
            var formData = new FormData();
            this.fileUploaded = file;
            this._formService.arrayFiles.append('uploadFile', file, this.objStep.name);
            console.log(this._formService.arrayFiles.get('uploadFile'));
            this.url_uploaded_file = 'blabla';
            var fileToUpload = event.dataTransfer ? event.dataTransfer.files[0] : event.target.files[0];
            var pattern = /image-*/;
            var reader = new FileReader();
            if (!fileToUpload.type.match(pattern)) {
                alert('invalid format');
                return;
            }
            reader.onload = this._handleReaderLoaded.bind(this);
            reader.readAsDataURL(fileToUpload);
            this.isUploaded = true;
        }
    };
    FileUploadComponent.prototype._handleReaderLoaded = function (e) {
        var reader = e.target;
        this.imageSrc = reader.result;
    };
    FileUploadComponent.prototype.onChange = function (event) {
        var eventObj = event;
        var target = eventObj.target;
        var files = target.files;
        this.file = files[0];
        console.log(this.file);
        this._fileUploadService.storeFile(files[0])
            .subscribe(function (data) {
            console.log(data);
        }, function (error) { return console.log(error); });
    };
    FileUploadComponent.prototype.goToStep = function () {
        this.sent.emit({
            stepIdx: this.stepIdx
        });
    };
    FileUploadComponent.prototype.goToNextStep = function () {
        this.sent.emit({
            valueName: this.objStep.name,
            url_uploaded: this.url_uploaded_file,
            id_img: this.id_img,
            fileUploaded: this.fileUploaded,
            stepIdx: this.stepIdx
        });
    };
    __decorate([
        core_1.Input(), 
        __metadata('design:type', Object)
    ], FileUploadComponent.prototype, "objStep", void 0);
    __decorate([
        core_1.Input(), 
        __metadata('design:type', Object)
    ], FileUploadComponent.prototype, "stepIdx", void 0);
    __decorate([
        core_1.Output(), 
        __metadata('design:type', Object)
    ], FileUploadComponent.prototype, "sent", void 0);
    FileUploadComponent = __decorate([
        core_1.Component({
            selector: 'file-upload',
            template: "\n    <div>\n       <div class=\"panel-heading panel-heading-custom\"><p class=\"text-uppercase\">{{objStep.configuration.labelPanel}}</p> </div>\n       <div class=\"panel-body\">\n        <!--<input type=\"filepicker\" name=\"myName\" onchange=\"alert(event.fpfile.url)\"/>-->\n        <!--<input type=\"file\" ng2FileSelect [uploader]=\"uploader\"/>-->\n        <table>\n            <tr>\n                <td>\n                    <input type=\"file\" (change)=\"fileChange($event)\" placeholder=\"Upload file\" accept=\".jpeg,.jpg,.png,.pdf,.doc,.docx\">\n                </td>\n            <tr>\n            <tr>\n                <td> \n                    <img src=\"{{objStep.configuration.path_model}}\" width=\"480\" height=\"320\"> \n                </td>\n            </tr>\n            <tr>\n                <td *ngIf=\"this.isUploaded\">\n                    <img src=\"{{imageSrc}}\" width=\"480\" height=\"320\">\n                    <!--<img src=\"{{this.url_uploaded_file}}\" width=\"480\" height=\"320\">    -->\n                </td>\n            </tr>\n            \n        \n        </table>\n               <div *ngIf=\"this.isUploaded == false\"><button type=\"button\" btn-default btn-lg (click)=\"goToStep()\">JE NE SOUHAITE PAS AJOUTER DES PHOTOS</button></div>\n               <div *ngIf=\"this.isUploaded\"><button type=\"button\" btn-default btn-lg (click)=\"goToNextStep()\">SUIVANT</button></div>\n        <!--<input name=\"file\" type=\"file\" (change)=\"onChange($event)\"/>-->\n        <!--<input type=\"filepicker\" data-fp-apikey=\"AgaXy7tWgRMuzr11Hh6OJz\"-->\n               <!--onchange=\"console.log(event.fpfile)\">-->\n\n      <!--<input type=\"file\" ng2FileSelect [uploader]=\"uploader\" accept=\"image/*;capture=camera\">-->\n\n    <!--<button (click)=\"upload()\">Upload</button>-->\n\n<!--<cl-image [public-id]=\"imageId\" [cloud-name]=\"uploader.cloudName\"></cl-image>-->\n<!--<input type=\"button\" value=\"Upload\" onclick=\"showPicker()\" />-->\n<!--<input type=\"filepicker-dragdrop\" data-fp-apikey=\"AgaXy7tWgRMuzr11Hh6OJz\" data-fp-mimetypes=\"*/*\" data-fp-container=\"modal\" data-fp-maxsize=\"10000000\" data-fp-store-location=\"S3\" onchange=\"alert(event.fpfile.url)\">-->\n       </div>\n    \n    </div>\n" }), 
        __metadata('design:paramtypes', [fileUpload_service_1.FileUploadService, http_1.Http, form_service_1.FormService])
    ], FileUploadComponent);
    return FileUploadComponent;
}());
exports.FileUploadComponent = FileUploadComponent;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZmlsZVVwbG9hZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEscUJBQXFELGVBQWUsQ0FBQyxDQUFBO0FBRXJFLHFCQUE0QyxlQUFlLENBQUMsQ0FBQTtBQUc1RCxtQ0FBZ0Msc0JBQXNCLENBQUMsQ0FBQTtBQUV2RCw2QkFBMEIsZ0JBQWdCLENBQUMsQ0FBQTtBQXNEM0M7SUFrQkksNkJBQW9CLGtCQUFzQyxFQUFVLEtBQVcsRUFDM0QsWUFBeUI7UUFEekIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUFVLFVBQUssR0FBTCxLQUFLLENBQU07UUFDM0QsaUJBQVksR0FBWixZQUFZLENBQWE7UUFqQjdDLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFJbkIscUJBQWdCLEdBQWEsRUFBRSxDQUFDO1FBR2hDLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFRTixTQUFJLEdBQUcsSUFBSSxtQkFBWSxFQUFFLENBQUM7SUFXcEMsQ0FBQztJQUdELG9DQUFNLEdBQU47SUFFQSxDQUFDO0lBQ0Esc0NBQVEsR0FBUjtRQUNHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDckQsQ0FBQztJQWNGLHdDQUFVLEdBQVYsVUFBVyxLQUFLO1FBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBR3JCLElBQUksUUFBUSxHQUFhLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ2hELEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQixJQUFJLElBQUksR0FBUyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0IsSUFBSSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztZQUU5QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztZQUN6QixJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFFNUQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFFBQVEsQ0FBQztZQUVsQyxJQUFJLFlBQVksR0FBRyxLQUFLLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTVGLElBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQztZQUN4QixJQUFJLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBRTlCLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNwQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDeEIsTUFBTSxDQUFDO1lBQ1gsQ0FBQztZQUlELE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwRCxNQUFNLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBT25DLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBa0IzQixDQUFDO0lBQVEsQ0FBQztJQUVmLGlEQUFtQixHQUFuQixVQUFvQixDQUFDO1FBQ2pCLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBR2xDLENBQUM7SUFFRyxzQ0FBUSxHQUFSLFVBQVMsS0FBa0I7UUFDdkIsSUFBSSxRQUFRLEdBQWdELEtBQUssQ0FBQztRQUNsRSxJQUFJLE1BQU0sR0FBd0MsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUNsRSxJQUFJLEtBQUssR0FBYSxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXZCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3RDLFNBQVMsQ0FBQyxVQUFBLElBQUk7WUFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3JCLENBQUMsRUFDRCxVQUFBLEtBQUssSUFBSSxPQUFBLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQWxCLENBQWtCLENBQzlCLENBQUE7SUFDVCxDQUFDO0lBRUQsc0NBQVEsR0FBUjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ1gsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1NBQ3hCLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCwwQ0FBWSxHQUFaO1FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDWCxTQUFTLEVBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJO1lBQzdCLFlBQVksRUFBRSxJQUFJLENBQUMsaUJBQWlCO1lBQ3BDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtZQUNuQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7WUFDL0IsT0FBTyxFQUFHLElBQUksQ0FBQyxPQUFPO1NBQ3pCLENBQUMsQ0FBQTtJQUNOLENBQUM7SUEvSEQ7UUFBQyxZQUFLLEVBQUU7O3dEQUFBO0lBQ1I7UUFBQyxZQUFLLEVBQUU7O3dEQUFBO0lBQ1I7UUFBQyxhQUFNLEVBQUU7O3FEQUFBO0lBL0RiO1FBQUMsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLFFBQVEsRUFBRSw4dEVBMENiLEVBQUMsQ0FBQzs7MkJBQUE7SUF5SkgsMEJBQUM7QUFBRCxDQXZKQSxBQXVKQyxJQUFBO0FBdkpZLDJCQUFtQixzQkF1Si9CLENBQUEiLCJmaWxlIjoiY29tcG9uZW50cy9maWxlVXBsb2FkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlcn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbi8vIGltcG9ydCB7RmlsZVVwbG9hZFNlcnZpY2V9IGZyb20gXCIuL2ZpbGVVcGxvYWQuc2VydmljZVwiO1xuaW1wb3J0IHtIdHRwLCBSZXF1ZXN0T3B0aW9ucywgSGVhZGVyc30gZnJvbSBcIkBhbmd1bGFyL2h0dHBcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9PYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBDbG91ZGluYXJ5T3B0aW9ucywgQ2xvdWRpbmFyeVVwbG9hZGVyIH0gZnJvbSAnbmcyLWNsb3VkaW5hcnknO1xuaW1wb3J0IHtGaWxlVXBsb2FkU2VydmljZX0gZnJvbSBcIi4vZmlsZVVwbG9hZC5zZXJ2aWNlXCI7XG5pbXBvcnQge0dsb2JhbFZhcmlhYmxlfSBmcm9tIFwiLi4vZ2xvYmFsXCI7XG5pbXBvcnQge0Zvcm1TZXJ2aWNlfSBmcm9tIFwiLi9mb3JtLnNlcnZpY2VcIjtcbmRlY2xhcmUgY29uc3QgZmlsZXN0YWNrOiB7XG4gICAgaW5pdChhcGlLZXk6IHN0cmluZyk6IHtcbiAgICAgICAgcGljayh7IG1heEZpbGVzIH06IHsgbWF4RmlsZXM6IG51bWJlciB9KTpcbiAgICAgICAgICAgIFByb21pc2U8eyBmaWxlc1VwbG9hZGVkOiB7IHVybDogc3RyaW5nIH1bXSB9PlxuICAgIH1cbn07XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnZmlsZS11cGxvYWQnLFxuICAgIHRlbXBsYXRlOiBgXG4gICAgPGRpdj5cbiAgICAgICA8ZGl2IGNsYXNzPVwicGFuZWwtaGVhZGluZyBwYW5lbC1oZWFkaW5nLWN1c3RvbVwiPjxwIGNsYXNzPVwidGV4dC11cHBlcmNhc2VcIj57e29ialN0ZXAuY29uZmlndXJhdGlvbi5sYWJlbFBhbmVsfX08L3A+IDwvZGl2PlxuICAgICAgIDxkaXYgY2xhc3M9XCJwYW5lbC1ib2R5XCI+XG4gICAgICAgIDwhLS08aW5wdXQgdHlwZT1cImZpbGVwaWNrZXJcIiBuYW1lPVwibXlOYW1lXCIgb25jaGFuZ2U9XCJhbGVydChldmVudC5mcGZpbGUudXJsKVwiLz4tLT5cbiAgICAgICAgPCEtLTxpbnB1dCB0eXBlPVwiZmlsZVwiIG5nMkZpbGVTZWxlY3QgW3VwbG9hZGVyXT1cInVwbG9hZGVyXCIvPi0tPlxuICAgICAgICA8dGFibGU+XG4gICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAgPHRkPlxuICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImZpbGVcIiAoY2hhbmdlKT1cImZpbGVDaGFuZ2UoJGV2ZW50KVwiIHBsYWNlaG9sZGVyPVwiVXBsb2FkIGZpbGVcIiBhY2NlcHQ9XCIuanBlZywuanBnLC5wbmcsLnBkZiwuZG9jLC5kb2N4XCI+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICA8dGQ+IFxuICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cInt7b2JqU3RlcC5jb25maWd1cmF0aW9uLnBhdGhfbW9kZWx9fVwiIHdpZHRoPVwiNDgwXCIgaGVpZ2h0PVwiMzIwXCI+IFxuICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgIDx0ZCAqbmdJZj1cInRoaXMuaXNVcGxvYWRlZFwiPlxuICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cInt7aW1hZ2VTcmN9fVwiIHdpZHRoPVwiNDgwXCIgaGVpZ2h0PVwiMzIwXCI+XG4gICAgICAgICAgICAgICAgICAgIDwhLS08aW1nIHNyYz1cInt7dGhpcy51cmxfdXBsb2FkZWRfZmlsZX19XCIgd2lkdGg9XCI0ODBcIiBoZWlnaHQ9XCIzMjBcIj4gICAgLS0+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwidGhpcy5pc1VwbG9hZGVkID09IGZhbHNlXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgYnRuLWRlZmF1bHQgYnRuLWxnIChjbGljayk9XCJnb1RvU3RlcCgpXCI+SkUgTkUgU09VSEFJVEUgUEFTIEFKT1VURVIgREVTIFBIT1RPUzwvYnV0dG9uPjwvZGl2PlxuICAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cInRoaXMuaXNVcGxvYWRlZFwiPjxidXR0b24gdHlwZT1cImJ1dHRvblwiIGJ0bi1kZWZhdWx0IGJ0bi1sZyAoY2xpY2spPVwiZ29Ub05leHRTdGVwKClcIj5TVUlWQU5UPC9idXR0b24+PC9kaXY+XG4gICAgICAgIDwhLS08aW5wdXQgbmFtZT1cImZpbGVcIiB0eXBlPVwiZmlsZVwiIChjaGFuZ2UpPVwib25DaGFuZ2UoJGV2ZW50KVwiLz4tLT5cbiAgICAgICAgPCEtLTxpbnB1dCB0eXBlPVwiZmlsZXBpY2tlclwiIGRhdGEtZnAtYXBpa2V5PVwiQWdhWHk3dFdnUk11enIxMUhoNk9KelwiLS0+XG4gICAgICAgICAgICAgICA8IS0tb25jaGFuZ2U9XCJjb25zb2xlLmxvZyhldmVudC5mcGZpbGUpXCI+LS0+XG5cbiAgICAgIDwhLS08aW5wdXQgdHlwZT1cImZpbGVcIiBuZzJGaWxlU2VsZWN0IFt1cGxvYWRlcl09XCJ1cGxvYWRlclwiIGFjY2VwdD1cImltYWdlLyo7Y2FwdHVyZT1jYW1lcmFcIj4tLT5cblxuICAgIDwhLS08YnV0dG9uIChjbGljayk9XCJ1cGxvYWQoKVwiPlVwbG9hZDwvYnV0dG9uPi0tPlxuXG48IS0tPGNsLWltYWdlIFtwdWJsaWMtaWRdPVwiaW1hZ2VJZFwiIFtjbG91ZC1uYW1lXT1cInVwbG9hZGVyLmNsb3VkTmFtZVwiPjwvY2wtaW1hZ2U+LS0+XG48IS0tPGlucHV0IHR5cGU9XCJidXR0b25cIiB2YWx1ZT1cIlVwbG9hZFwiIG9uY2xpY2s9XCJzaG93UGlja2VyKClcIiAvPi0tPlxuPCEtLTxpbnB1dCB0eXBlPVwiZmlsZXBpY2tlci1kcmFnZHJvcFwiIGRhdGEtZnAtYXBpa2V5PVwiQWdhWHk3dFdnUk11enIxMUhoNk9KelwiIGRhdGEtZnAtbWltZXR5cGVzPVwiKi8qXCIgZGF0YS1mcC1jb250YWluZXI9XCJtb2RhbFwiIGRhdGEtZnAtbWF4c2l6ZT1cIjEwMDAwMDAwXCIgZGF0YS1mcC1zdG9yZS1sb2NhdGlvbj1cIlMzXCIgb25jaGFuZ2U9XCJhbGVydChldmVudC5mcGZpbGUudXJsKVwiPi0tPlxuICAgICAgIDwvZGl2PlxuICAgIFxuICAgIDwvZGl2PlxuYH0pXG5cbmV4cG9ydCBjbGFzcyBGaWxlVXBsb2FkQ29tcG9uZW50IHtcblxuICAgIGlzVXBsb2FkZWQgPSBmYWxzZTtcbiAgICBpZF9pbWc6IHN0cmluZztcbiAgICB1cmxfdXBsb2FkZWRfZmlsZTtcblxuICAgIHVwbG9hZGVkRmlsZVVybHM6IHN0cmluZ1tdID0gW107XG4gICAgaW1hZ2VTcmM6IHN0cmluZztcbiAgICBjbG91ZGluYXJ5SW1hZ2U6IGFueTtcbiAgICBkaXNwbGF5ID0gZmFsc2U7XG4gICAgIC8vIHVwbG9hZGVyOiBDbG91ZGluYXJ5VXBsb2FkZXIgPSBuZXcgQ2xvdWRpbmFyeVVwbG9hZGVyKFxuICAgICAvLyAgICAgbmV3IENsb3VkaW5hcnlPcHRpb25zKHsgY2xvdWROYW1lOiAnaGF2amNxcHB2JywgdXBsb2FkUHJlc2V0OiAnb2kyeDYxZGInIH0pXG4gICAgIC8vICk7XG4gICAgZmlsZSA6IEZpbGU7XG4gICAgZmlsZVVwbG9hZGVkIDogRmlsZTtcbiAgICBASW5wdXQoKSBvYmpTdGVwOyAgICAgLy9WYWx1ZSByZWNlaXZlZCBmcm9tIE1haW5Db21wb25lbnRcbiAgICBASW5wdXQoKSBzdGVwSWR4OyAgICAgLy9WYWx1ZSByZWNlaXZlZCBmcm9tIE1haW5Db21wb25lbnRcbiAgICBAT3V0cHV0KCkgc2VudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTsgLy8gRW1pdHRlciB0byBzZW5kIGJhY2sgZGF0YSB0byBwYXJlbnQgY29tcG9uZW50XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfZmlsZVVwbG9hZFNlcnZpY2UgOiBGaWxlVXBsb2FkU2VydmljZSwgcHJpdmF0ZSBfaHR0cDogSHR0cCxcbiAgICAgICAgICAgICAgICBwcml2YXRlIF9mb3JtU2VydmljZTogRm9ybVNlcnZpY2UpIHtcbiAgICAgICAgLy8gICwgdGhpcy51cGxvYWRlci5vblN1Y2Nlc3NJdGVtID0gKGl0ZW06IGFueSwgcmVzcG9uc2U6IHN0cmluZywgc3RhdHVzOiBudW1iZXIsIGhlYWRlcnM6IGFueSkgPT4ge1xuICAgICAgICAvLyAgICAgLy9yZXNwb25zZSBpcyB0aGUgY2xvdWRpbmFyeSByZXNwb25zZVxuICAgICAgICAvLyAgICAgLy9zZWUgaHR0cDovL2Nsb3VkaW5hcnkuY29tL2RvY3VtZW50YXRpb24vdXBsb2FkX2ltYWdlcyN1cGxvYWRfcmVzcG9uc2VcbiAgICAgICAgLy8gICAgIGxldCByZXM6IGFueSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAvLyAgICAgdGhpcy5pbWFnZUlkID0gcmVzLnB1YmxpY19pZDtcbiAgICAgICAgLy8gICAgIHJldHVybiB7IGl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMgfTtcbiAgICAgICAgLy8gfTtcblxuICAgIH1cblxuXG4gICAgdXBsb2FkKCkge1xuICAgICAgICAvLyB0aGlzLnVwbG9hZGVyLnVwbG9hZEFsbCgpO1xuICAgIH1cbiAgICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMub2JqU3RlcCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMub2JqU3RlcC5jb25maWd1cmF0aW9uLnBhdGhfbW9kZWwpXG4gICAgIH1cbiAgICAgICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy8gICAgIC8vIHZhciBjbGllbnQgPSBmaWxlc3RhY2suaW5pdCgnQWdhWHk3dFdnUk11enIxMUhoNk9KeicpO1xuICAgIC8vICAgICAvLyBmdW5jdGlvbiBzaG93UGlja2VyKCkge1xuICAgIC8vICAgICAvLyAgICAgY2xpZW50LnBpY2soe1xuICAgIC8vICAgICAvLyAgICAgfSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAvLyAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHQuZmlsZXNVcGxvYWRlZCkpXG4gICAgLy8gICAgIC8vICAgICB9KTtcbiAgICAvLyAgICAgLy8gfVxuICAgIC8vIH1cbiAgICAvL1xuXG4gICAgZmlsZUNoYW5nZShldmVudCkge1xuICAgIGNvbnNvbGUubG9nKGV2ZW50LnRhcmdldCk7XG4gIC8vIEdBUkRFUiBGSUNISUVSIERBTlMgTEUgQ0FDSEVcblxuICAgICAgICAgbGV0IGZpbGVMaXN0OiBGaWxlTGlzdCA9IGV2ZW50LnRhcmdldC5maWxlcztcbiAgICAgaWYoZmlsZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgbGV0IGZpbGU6IEZpbGUgPSBmaWxlTGlzdFswXTtcbiAgICAgICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXG4gICAgICAgICB0aGlzLmZpbGVVcGxvYWRlZCA9IGZpbGU7XG4gICAgICAgICB0aGlzLl9mb3JtU2VydmljZS5hcnJheUZpbGVzLmFwcGVuZCgndXBsb2FkRmlsZScsIGZpbGUsIHRoaXMub2JqU3RlcC5uYW1lKTtcbiAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuX2Zvcm1TZXJ2aWNlLmFycmF5RmlsZXMuZ2V0KCd1cGxvYWRGaWxlJykpO1xuXG4gICAgICAgICB0aGlzLnVybF91cGxvYWRlZF9maWxlID0gJ2JsYWJsYSc7XG4gICAgICAgICAvL1xuICAgICAgICAgdmFyIGZpbGVUb1VwbG9hZCA9IGV2ZW50LmRhdGFUcmFuc2ZlciA/IGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlc1swXSA6IGV2ZW50LnRhcmdldC5maWxlc1swXTtcblxuICAgICAgICAgdmFyIHBhdHRlcm4gPSAvaW1hZ2UtKi87XG4gICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICAgaWYgKCFmaWxlVG9VcGxvYWQudHlwZS5tYXRjaChwYXR0ZXJuKSkge1xuICAgICAgICAgICAgIGFsZXJ0KCdpbnZhbGlkIGZvcm1hdCcpO1xuICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgIH1cblxuICAgICAgICAgLy8gdGhpcy5sb2FkZWQgPSBmYWxzZTtcblxuICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IHRoaXMuX2hhbmRsZVJlYWRlckxvYWRlZC5iaW5kKHRoaXMpO1xuICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZVRvVXBsb2FkKTtcbi8vIEZJTiBHQVJERVIgRklDSElFUiBEQU5TIExFIENBQ0hFXG5cbiAgICAgICAgIC8vIHRoaXMuX2Zvcm1TZXJ2aWNlLmFycmF5U3RlcHMucHVzaCh7XCJub21cIjogdGhpcy5vYmpTdGVwLm5hbWUsIFwiZmlsZVwiOiBGaWxlfSk7XG4gICAgICAgICAvL3RoaXMuX2Zvcm1TZXJ2aWNlLmFycmF5RmlsZXMucHVzaChmb3JtRGF0YSk7XG5cblxuICAgICAgICAgdGhpcy5pc1VwbG9hZGVkID0gdHJ1ZTtcblxuICAgICAgICAgLy8gbGV0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICAgLy8gaGVhZGVycy5hcHBlbmQoJ0VuY1R5cGUnLCAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpO1xuICAgICAgICAgLy8gaGVhZGVycy5hcHBlbmQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgICAgICAvLyBsZXQgb3B0aW9ucyA9IG5ldyBSZXF1ZXN0T3B0aW9ucyh7aGVhZGVyczogaGVhZGVyc30pO1xuICAgICAgICAgLy8gdmFyIGNvbXBsZXRlVXJsID0gR2xvYmFsVmFyaWFibGUuQkFTRV9VUkwgKyAnc3RvcmVfZmlsZSc7XG4gICAgICAgICAvLyB0aGlzLl9odHRwLnBvc3QoYCR7Y29tcGxldGVVcmx9YCwgZm9ybURhdGEsIHtoZWFkZXJzOiBoZWFkZXJzfSlcbiAgICAgICAgIC8vICAgICAubWFwKHJlcyA9PiByZXMuanNvbigpKVxuICAgICAgICAgLy8gICAgIC5jYXRjaChlcnJvciA9PiBPYnNlcnZhYmxlLnRocm93KGVycm9yKSlcbiAgICAgICAgIC8vICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgLy8gICAgICAgICBkYXRhID0+IHtcbiAgICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdWNjZXNzJylcbiAgICAgICAgIC8vICAgICAgICAgICAgIHRoaXMudXJsX3VwbG9hZGVkX2ZpbGUgPSBkYXRhLnVybDtcbiAgICAgICAgIC8vICAgICAgICAgICAgIHRoaXMuaWRfaW1nID0gZGF0YS5pZF9pbWc7XG4gICAgICAgICAvLyAgICAgICAgIH0sXG4gICAgICAgICAvLyAgICAgICAgIGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICAgLy8gICAgIClcbiAgICAgfSAgICAgICAgfVxuXG5faGFuZGxlUmVhZGVyTG9hZGVkKGUpIHtcbiAgICB2YXIgcmVhZGVyID0gZS50YXJnZXQ7XG4gICAgdGhpcy5pbWFnZVNyYyA9IHJlYWRlci5yZXN1bHQ7XG4gICAvLyBjb25zb2xlLmxvZyh0aGlzLmltYWdlU3JjKVxuICAgIC8vdGhpcy5sb2FkZWQgPSB0cnVlO1xufVxuXG4gICAgb25DaGFuZ2UoZXZlbnQ6IEV2ZW50VGFyZ2V0KSB7XG4gICAgICAgIGxldCBldmVudE9iajogTVNJbnB1dE1ldGhvZENvbnRleHQgPSA8TVNJbnB1dE1ldGhvZENvbnRleHQ+IGV2ZW50O1xuICAgICAgICBsZXQgdGFyZ2V0OiBIVE1MSW5wdXRFbGVtZW50ID0gPEhUTUxJbnB1dEVsZW1lbnQ+IGV2ZW50T2JqLnRhcmdldDtcbiAgICAgICAgbGV0IGZpbGVzOiBGaWxlTGlzdCA9IHRhcmdldC5maWxlcztcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZXNbMF07XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZmlsZSk7XG5cbiAgICAgICAgdGhpcy5fZmlsZVVwbG9hZFNlcnZpY2Uuc3RvcmVGaWxlKGZpbGVzWzBdKVxuICAgICAgICAgICAgLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSlcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICAgICAgKVxuICAgIH1cblxuICAgIGdvVG9TdGVwKCl7XG4gICAgICAgIHRoaXMuc2VudC5lbWl0KHtcbiAgICAgICAgICAgIHN0ZXBJZHg6IHRoaXMuc3RlcElkeFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGdvVG9OZXh0U3RlcCgpIHtcbiAgICAgICAgdGhpcy5zZW50LmVtaXQoe1xuICAgICAgICAgICAgdmFsdWVOYW1lIDogdGhpcy5vYmpTdGVwLm5hbWUsXG4gICAgICAgICAgICB1cmxfdXBsb2FkZWQ6IHRoaXMudXJsX3VwbG9hZGVkX2ZpbGUsXG4gICAgICAgICAgICBpZF9pbWc6IHRoaXMuaWRfaW1nLFxuICAgICAgICAgICAgZmlsZVVwbG9hZGVkOiB0aGlzLmZpbGVVcGxvYWRlZCxcbiAgICAgICAgICAgIHN0ZXBJZHggOiB0aGlzLnN0ZXBJZHhcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIGFzeW5jIHNob3dQaWNrZXIoKSB7XG4gICAgLy8gICAgIGNvbnN0IGNsaWVudCA9IGZpbGVzdGFjay5pbml0KCdBZ2FYeTd0V2dSTXV6cjExSGg2T0p6Jyk7XG4gICAgLy8gICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5waWNrKHsgbWF4RmlsZXM6IDEgfSk7XG4gICAgLy8gICAgIGNvbnN0IHVybCA9IHJlc3VsdC5maWxlc1VwbG9hZGVkWzBdLnVybDtcbiAgICAvLyAgICAgdGhpcy51cGxvYWRlZEZpbGVVcmxzLnB1c2godXJsKTtcbiAgICAvLyB9XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
